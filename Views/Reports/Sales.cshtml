@model IEnumerable<ERPSystem.Models.Invoice>
@{
    ViewData["Title"] = "Ventas";
    var list = Model.ToList();
}
@section Styles {
    <link rel="stylesheet" href="~/css/print.css" />
}


<h2>Ventas</h2>

<form method="get" class="row g-2 mb-3">
    <div class="col-md-3"><input type="date" name="from" class="form-control" value="@((ViewBag.From as DateTime?)?.ToString("yyyy-MM-dd"))" /></div>
    <div class="col-md-3"><input type="date" name="to" class="form-control" value="@((ViewBag.To as DateTime?)?.ToString("yyyy-MM-dd"))" /></div>
    <div class="col-md-3">
        <select name="clientId" class="form-select">
            <option value="0">-- Todos --</option>
            @foreach(var c in ViewBag.Clients as List<ERPSystem.Models.Client>)
            {
                <option value="@c.ClientId" selected="@(ViewBag.ClientId == c.ClientId ? "selected" : null)">@c.Name</option>
            }
        </select>
    </div>
    <div class="col-md-3">
        <button class="btn btn-primary"><i class="bi bi-funnel-fill"></i>Filtrar</button>
        <a class="btn btn-outline-success ms-2" href="@Url.Action("Sales", new { from = (ViewBag.From as DateTime?)?.ToString("yyyy-MM-dd"), to = (ViewBag.To as DateTime?)?.ToString("yyyy-MM-dd"), clientId = ViewBag.ClientId, export = "excel" })"><i class="bi bi-file-earmark-excel-fill"></i>Exportar Excel</a>
    </div>
</form>

<table class="table table-striped table-bordered">
    <thead class="table-dark">
        <tr><th>#</th><th>Cliente</th><th>Fecha</th><th>Total</th><th>Pagado</th><th>Estado</th></tr>
    </thead>
    <tbody>
        @foreach(var inv in list)
        {
            <tr>
                <td>@inv.InvoiceId</td>
                <td>@inv.Client?.Name</td>
                <td>@inv.InvoiceDate.ToString("dd/MM/yyyy")</td>
                <td>@inv.Total.ToString("C")</td>
                <td>@inv.PaidAmount.ToString("C")</td>
                <td>@inv.Status</td>
            </tr>
        }
    </tbody>
</table>
@await Html.PartialAsync("_BackToIndexButton", "Index")