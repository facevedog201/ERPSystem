@model IEnumerable<ERPSystem.Models.Service>
@{
    ViewData["Title"] = "Servicios";
}

<h1>@ViewData["Title"]</h1>

<div class="mb-3">
    <a asp-action="Create" class="btn btn-primary me-2">
        <i class="bi bi-plus-circle me-2"></i> Crear Nuevo Servicio
    </a>
    <a asp-action="InactiveServices" class="btn btn-secondary">
        <i class="bi bi-eye-slash me-2"></i> Ver Inactivos
    </a>
</div>

<!-- Buscador dinámico -->
<div class="row mb-3">
    <div class="col-md-6">
        <input type="text" id="searchInputService" class="form-control"
               placeholder="Buscar por nombre, descripción o precio..." />
    </div>
</div>

<!-- Loader -->
<div id="loadingSpinner" class="text-center my-3" style="display:none;">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
    </div>
</div>

<!-- Contenedor -->
<div id="servicesContainer">
    @await Html.PartialAsync("_ServicesTable", Model)
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            let typingTimer;
            const doneTypingInterval = 400;

            $("#searchInputService").on("keyup", function () {
                clearTimeout(typingTimer);
                const query = $(this).val();

                typingTimer = setTimeout(function () {
                    $.ajax({
                        url: '/Services/FilterServices',
                        type: 'GET',
                        data: { search: query },
                        beforeSend: function () {
                            $("#loadingSpinner").fadeIn(150);
                        },
                        success: function (result) {
                            $("#servicesContainer").hide().html(result).fadeIn(150);
                        },
                        complete: function () {
                            $("#loadingSpinner").fadeOut(150);
                        },
                        error: function () {
                            console.error("Error al filtrar servicios activos");
                        }
                    });
                }, doneTypingInterval);
            });
        });
    </script>
}
