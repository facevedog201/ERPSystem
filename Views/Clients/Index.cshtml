@model IEnumerable<ERPSystem.Models.Client>
@{
    ViewData["Title"] = "Clientes";
}

<h1>@ViewData["Title"]</h1>

<div class="mb-3">
    <a asp-action="Create" class="btn btn-primary me-2">
        <i class="bi bi-save me-2"></i> Crear Nuevo Cliente
    </a>
    <a asp-action="InactiveClients" class="btn btn-secondary">
        <i class="bi bi-eye-slash me-2"></i> Ver Clientes Inactivos
    </a>
</div>

<!-- Buscador dinámico -->
<div class="row mb-3">
    <div class="col-md-6">
        <input type="text" id="searchInput" class="form-control"
               placeholder="Buscar por Nombre, RUC, Teléfono o Correo..." />
    </div>
</div>

<!-- Loader -->
<div id="loadingSpinner" class="text-center my-3" style="display:none;">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
    </div>
</div>

<!-- Contenedor de resultados -->
<div id="clientsContainer">
    @await Html.PartialAsync("_ClientsTable", Model)
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            let typingTimer;
            const doneTypingInterval = 400; // ms

            $("#searchInput").on("keyup", function () {
                clearTimeout(typingTimer);
                const query = $(this).val();

                typingTimer = setTimeout(function () {
                    $.ajax({
                        url: '/Clients/FilterClients',
                        type: 'GET',
                        data: { search: query },
                        beforeSend: function () {
                            $("#loadingSpinner").fadeIn(150);
                        },
                        success: function (result) {
                            $("#clientsContainer").hide().html(result).fadeIn(150);
                        },
                        complete: function () {
                            $("#loadingSpinner").fadeOut(150);
                        },
                        error: function () {
                            console.error("Error al filtrar clientes");
                        }
                    });
                }, doneTypingInterval);
            });
        });
    </script>
}
