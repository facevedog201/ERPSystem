@model IEnumerable<ERPSystem.Models.Provider>
@using ERPSystem.Helpers

<!-- Formulario de búsqueda -->
<div class="mb-3">
    <form method="get" action="@Url.Action("ProvidersList", "Providers")" class="form-inline">
        <div class="form-group mr-2">
            <label for="searchQuery">Buscar por Nombre, RUC, Teléfono o Correo:</label><p></p>
            <input type="text" id="searchQuery" name="searchQuery" class="form-control"
                   placeholder="Ingresa tu búsqueda..."
                   value="@Context.Request.Query["searchQuery"]" /><p></p>
        </div>
        <button type="submit" class="btn btn-secondary">Buscar</button>
        <a href="@Url.Action("ProvidersList", "Providers")" class="btn btn-outline-secondary ml-2">Limpiar</a>
    </form>

</div>

<div class="row row-cols-1 row-cols-md-3 g-4">
    @* Grid responsivo: 1 columna en móvil, 3 en desktop *@
    @foreach (var provider in Model)
    {
        <div class="col">
            <div class="card h-100 shadow-sm border-secondary position-relative">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">@provider.Name</h5>  @* Nombre como título del card *@
                </div>
                <div class="card-body">
                    <p><i class="bi bi-envelope me-2"></i><strong>Email:</strong> @provider.Email</p>  @* Icono para Email *@
                    <p><i class="bi bi-telephone me-2"></i><strong>Teléfono:</strong> @provider.Phone</p>  @* Icono para Teléfono *@
                    <p><i class="bi bi-geo-alt me-2"></i><strong>Dirección:</strong> @provider.Address</p>  @* Icono para Dirección *@
                    <p><i class="bi bi-check-circle me-2 @(provider.IsActive ? "text-success" : "text-danger")"></i><strong>Activo:</strong> @(provider.IsActive ? "Sí" : "No")</p>  @* Icono condicional para Activo *@
                </div>
                <div class="card-footer d-flex flex-wrap gap-2">
                    <a class="btn btn-sm btn-info" asp-action="Details" asp-route-id="@provider.ProviderId">Detalles</a>
                    <!-- Dentro del footer de cada card de proveedor -->
                    <a class="btn btn-sm btn-primary"
                       asp-controller="ProviderInvoices"
                       asp-action="Create"
                       asp-route-providerId="@provider.ProviderId">
                        <i class="bi bi-file-earmark-plus"></i> Nueva factura
                    </a>

                    <a class="btn btn-sm btn-outline-primary"
                       asp-controller="ProviderInvoices"
                       asp-action="Index"
                       asp-route-providerId="@provider.ProviderId">
                        <i class="bi bi-receipt"></i> Ver Facturas
                    </a>

                    @if (provider.IsActive)
                    {
                        @if (User.IsInRole(UserRole.Admin.ToString()) || User.IsInRole(UserRole.Recepcion.ToString()))
                        {
                            <a class="btn btn-sm btn-warning" asp-action="Edit" asp-route-id="@provider.ProviderId">Editar</a>
                            @if (User.IsInRole(UserRole.Admin.ToString()))
                            {
                                <a class="btn btn-sm btn-danger" asp-action="Delete" asp-route-id="@provider.ProviderId">Eliminar</a>
                            }
                        }
                    }
                    else
                    {
                        @if (User.IsInRole(UserRole.Admin.ToString()))
                        {
                            <a class="btn btn-sm btn-success" asp-action="Activate" asp-route-id="@provider.ProviderId">Reactivar</a>
                        }
                    }
                </div>
            </div>
        </div>
    }
</div>